  name: SonarCloud Analysis

  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

  jobs:
    sonarcloud:
      name: SonarCloud Scan
      runs-on: ubuntu-latest

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Set up JDK
          uses: actions/setup-java@v3
          with:
            distribution: 'temurin'
            java-version: '21'

        - name: Cache SonarCloud packages
          uses: actions/cache@v3
          with:
            path: ~/.sonar/cache
            key: ${{ runner.os }}-sonar
            restore-keys: ${{ runner.os }}-sonar

        - name: Build with JaCoCo and analyze with SonarCloud
          env:
            SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          run: |
            mvn clean verify sonar:sonar \
              -Dsonar.organization=picada \
              -Dsonar.projectKey=ZayraGS1403_SonarCloudAndPipelineItegrtion \
              -Dsonar.host.url=https://sonarcloud.io \
              -Dsonar.branch.name=main \
              -Dsonar.token=$SONAR_TOKEN \
              -Dsonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml